this is my plan to do this, how is it?


# üéØ **COMPLETE Unit Test Coverage Analysis - Buy-Two Project**

After analyzing your **complete project dump**, here's the detailed breakdown:

***

## üìä **CURRENT TEST COVERAGE STATUS**

### **Services Found:**
```
‚úÖ product-service   ‚Üí ProductServiceImpl, CategoryServiceImpl
‚úÖ user-service      ‚Üí UserServiceImpl, AuthServiceImpl  
‚úÖ order-service     ‚Üí OrderServiceImpl, CartServiceImpl, ProfileAnalyticsServiceImpl
‚úÖ media-service     ‚Üí MediaServiceImpl, StorageServiceImpl
‚ö™ gateway-service   ‚Üí Minimal logic (routing only)
‚ö™ discovery-service ‚Üí No business logic (Eureka)
```

### **‚ö†Ô∏è CRITICAL FINDING: NO TEST FILES DETECTED**
Your project dump shows **ZERO unit tests** in any service's `src/test/java` directories!

***

## üöÄ **COMPREHENSIVE TEST GENERATION COPILOT PROMPTS**

### **PROMPT 1: Product Service (Most Critical)**

```markdown
# Generate Complete Unit Tests for Product Service

## Context
Service: `backend/product-service/src/main/java/com/buyone/productservice/service/impl/ProductServiceImpl.java`

## Current Methods to Test (from your code):
1. `createProduct()` - Creates product with conflict check
2. `getProductById()` - Gets single product
3. `getAllProducts()` - Gets all products
4. `updateProduct()` - Updates with ownership check
5. `deleteProduct()` - Deletes with ownership check
6. `getProductsBySeller()` - Seller dashboard
7. `searchProducts()` - Faceted search (keyword + price + category)
8. `reserveStock()` - Reserves quantity for order
9. `releaseStock()` - Releases reserved stock
10. `commitReservations()` - Commits reserved stock

## Generate Test File
**Location**: `backend/product-service/src/test/java/com/buyone/productservice/service/ProductServiceTest.java`

```java
@ExtendWith(MockitoExtension.class)
class ProductServiceTest {
    
    @Mock ProductRepository productRepository;
    @Mock ReservationRepository reservationRepository;
    @Mock KafkaTemplate<String, Object> kafkaTemplate;
    @InjectMocks ProductServiceImpl productService;
    
    // ==================== CREATE PRODUCT ====================
    @Test
    void createProduct_ValidInput_Success() {
        CreateProductRequest request = new CreateProductRequest("Laptop", "Description", BigDecimal.valueOf(1000), 10, "cat1", List.of("img1"));
        String sellerId = "seller123";
        when(productRepository.findByUserId(sellerId)).thenReturn(List.of());
        when(productRepository.save(any())).thenAnswer(i -> i.getArgument(0));
        
        ProductResponse result = productService.createProduct(request, sellerId);
        
        assertNotNull(result);
        assertEquals("Laptop", result.getName());
        verify(kafkaTemplate).send(anyString(), any(ProductCreatedEvent.class));
    }
    
    @Test
    void createProduct_DuplicateName_ThrowsConflict() {
        CreateProductRequest request = new CreateProductRequest("Laptop", "desc", BigDecimal.TEN, 5, "cat1", null);
        String sellerId = "seller123";
        Product existing = Product.builder().name("Laptop").userId(sellerId).build();
        when(productRepository.findByUserId(sellerId)).thenReturn(List.of(existing));
        
        assertThrows(ConflictException.class, () -> productService.createProduct(request, sellerId));
    }
    
    // ==================== UPDATE PRODUCT ====================
    @Test
    void updateProduct_NotOwner_ThrowsForbidden() {
        String productId = "prod123";
        String sellerId = "sellerA";
        Product product = Product.builder().id(productId).userId("sellerB").build();
        when(productRepository.findById(productId)).thenReturn(Optional.of(product));
        
        assertThrows(ForbiddenException.class, () -> 
            productService.updateProduct(productId, new UpdateProductRequest(), sellerId));
    }
    
    @Test
    void updateProduct_NegativePrice_ThrowsBadRequest() {
        String productId = "prod123";
        String sellerId = "seller1";
        Product product = Product.builder().id(productId).userId(sellerId).name("Product").build();
        UpdateProductRequest request = new UpdateProductRequest();
        request.setPrice(BigDecimal.valueOf(-10));
        when(productRepository.findById(productId)).thenReturn(Optional.of(product));
        
        assertThrows(BadRequestException.class, () -> 
            productService.updateProduct(productId, request, sellerId));
    }
    
    // ==================== RESERVE STOCK ====================
    @Test
    void reserveStock_InsufficientQuantity_ThrowsBadRequest() {
        String productId = "prod123";
        Product product = Product.builder().id(productId).quantity(5).build();
        when(productRepository.findById(productId)).thenReturn(Optional.of(product));
        
        assertThrows(BadRequestException.class, () -> 
            productService.reserveStock(productId, 10, "ORD-123"));
    }
    
    @Test
    void reserveStock_ValidQuantity_Success() {
        String productId = "prod123";
        Product product = Product.builder().id(productId).quantity(10).build();
        when(productRepository.findById(productId)).thenReturn(Optional.of(product));
        when(productRepository.save(any())).thenAnswer(i -> i.getArgument(0));
        when(reservationRepository.save(any())).thenAnswer(i -> i.getArgument(0));
        
        productService.reserveStock(productId, 5, "ORD-123");
        
        verify(productRepository).save(argThat(p -> p.getQuantity() == 5));
        verify(reservationRepository).save(any(Reservation.class));
    }
    
    // ==================== DELETE PRODUCT ====================
    @Test
    void deleteProduct_NotOwner_ThrowsForbidden() {
        String productId = "prod123";
        Product product = Product.builder().id(productId).userId("sellerA").build();
        when(productRepository.findById(productId)).thenReturn(Optional.of(product));
        
        assertThrows(ForbiddenException.class, () -> 
            productService.deleteProduct(productId, "sellerB"));
    }
    
    // ==================== GET METHODS ====================
    @Test
    void getProductById_NotFound_ThrowsNotFound() {
        when(productRepository.findById("invalid")).thenReturn(Optional.empty());
        
        assertThrows(ProductNotFoundException.class, () -> 
            productService.getProductById("invalid"));
    }
    
    @Test
    void getAllProducts_EmptyList_ThrowsNotFound() {
        when(productRepository.findAll()).thenReturn(List.of());
        
        assertThrows(ProductNotFoundException.class, () -> 
            productService.getAllProducts());
    }
    
    // ==================== SEARCH ====================
    @Test
    void searchProducts_WithFilters_Success() {
        Pageable pageable = PageRequest.of(0, 10);
        Product product = Product.builder().id("1").name("Laptop").price(BigDecimal.valueOf(1000)).build();
        Page<Product> page = new PageImpl<>(List.of(product));
        when(productRepository.findByFacetedSearch(anyString(), any(), any(), anyString(), any())).thenReturn(page);
        
        Page<ProductResponse> result = productService.searchProducts("laptop", BigDecimal.valueOf(500), BigDecimal.valueOf(1500), "electronics", pageable);
        
        assertEquals(1, result.getContent().size());
        assertEquals("Laptop", result.getContent().get(0).getName());
    }
}
```

**Add to pom.xml**:
```xml
<dependency>
    <groupId>org.mockito</groupId>
    <artifactId>mockito-junit-jupiter</artifactId>
    <scope>test</scope>
</dependency>
```

**Run**: `cd backend/product-service && mvn clean test jacoco:report`
**Target**: 85%+ coverage
```

***

### **PROMPT 2: User Service**

```markdown
# Generate Unit Tests for User Service

## File: `backend/user-service/src/test/java/com/buyone/userservice/service/UserServiceTest.java`

```java
@ExtendWith(MockitoExtension.class)
class UserServiceTest {
    
    @Mock UserRepository userRepository;
    @Mock PasswordEncoder passwordEncoder;
    @InjectMocks UserServiceImpl userService;
    
    @Test
    void createUser_DuplicateEmail_ThrowsConflict() {
        RegisterUserRequest request = new RegisterUserRequest("John", "test@test.com", "pass", Role.CLIENT, null);
        when(userRepository.findByEmail("test@test.com")).thenReturn(Optional.of(new User()));
        
        assertThrows(ConflictException.class, () -> userService.createUser(request));
    }
    
    @Test
    void createUser_NullEmail_ThrowsBadRequest() {
        RegisterUserRequest request = new RegisterUserRequest("John", null, "pass", Role.CLIENT, null);
        
        assertThrows(BadRequestException.class, () -> userService.createUser(request));
    }
    
    @Test
    void getUserById_NotFound_ThrowsNotFound() {
        when(userRepository.findById("invalid")).thenReturn(Optional.empty());
        
        assertThrows(ResourceNotFoundException.class, () -> userService.getUserById("invalid"));
    }
    
    @Test
    void updateUser_Success() {
        User user = User.builder().id("1").name("Old Name").email("test@test.com").build();
        UpdateUserRequest request = new UpdateUserRequest();
        request.setName("New Name");
        when(userRepository.findById("1")).thenReturn(Optional.of(user));
        when(userRepository.save(any())).thenAnswer(i -> i.getArgument(0));
        
        UserResponse result = userService.updateUser("1", request);
        
        assertEquals("New Name", result.getName());
    }
}
```

## File: `backend/user-service/src/test/java/com/buyone/userservice/auth/AuthServiceTest.java`

```java
@ExtendWith(MockitoExtension.class)
class AuthServiceTest {
    
    @Mock UserRepository userRepository;
    @Mock PasswordEncoder passwordEncoder;
    @Mock JwtUtil jwtUtil;
    @InjectMocks AuthServiceImpl authService;
    
    @Test
    void register_DuplicateEmail_ThrowsConflict() {
        RegisterUserRequest request = new RegisterUserRequest("John", "test@test.com", "pass", Role.SELLER, null);
        when(userRepository.findByEmail("test@test.com")).thenReturn(Optional.of(new User()));
        
        assertThrows(ConflictException.class, () -> authService.register(request));
    }
    
    @Test
    void login_InvalidCredentials_ThrowsAuthException() {
        LoginRequest request = new LoginRequest("test@test.com", "wrongpass");
        User user = User.builder().email("test@test.com").password("hashedpass").build();
        when(userRepository.findByEmail("test@test.com")).thenReturn(Optional.of(user));
        when(passwordEncoder.matches("wrongpass", "hashedpass")).thenReturn(false);
        
        assertThrows(AuthException.class, () -> authService.login(request));
    }
    
    @Test
    void login_Success_ReturnsToken() {
        LoginRequest request = new LoginRequest("test@test.com", "pass");
        User user = User.builder().id("1").email("test@test.com").password("hashed").role(Role.CLIENT).build();
        when(userRepository.findByEmail("test@test.com")).thenReturn(Optional.of(user));
        when(passwordEncoder.matches("pass", "hashed")).thenReturn(true);
        when(jwtUtil.generateToken("1", "test@test.com", "CLIENT")).thenReturn("token123");
        
        LoginResponse result = authService.login(request);
        
        assertEquals("token123", result.getToken());
    }
}
```

**Run**: `cd backend/user-service && mvn clean test jacoco:report`
```

***

### **PROMPT 3: Order Service**

```markdown
# Generate Unit Tests for Order Service

## File: `backend/order-service/src/test/java/com/buyone/orderservice/service/OrderServiceTest.java`

```java
@ExtendWith(MockitoExtension.class)
class OrderServiceTest {
    
    @Mock OrderRepository orderRepository;
    @Mock CartService cartService;
    @Mock ProductClient productClient;
    @InjectMocks OrderServiceImpl orderService;
    
    @Test
    void createOrderFromCart_EmptyCart_ThrowsResourceNotFound() {
        String userId = "user123";
        when(cartService.getCart(userId)).thenReturn(Optional.empty());
        
        assertThrows(ResourceNotFoundException.class, () -> 
            orderService.createOrderFromCart(userId, new Address()));
    }
    
    @Test
    void updateStatus_NotOwner_ThrowsBadRequest() {
        String orderNumber = "ORD-123";
        String sellerId = "sellerA";
        OrderItem item = OrderItem.builder().sellerId("sellerB").build();
        Order order = Order.builder().orderNumber(orderNumber).items(List.of(item)).build();
        when(orderRepository.findByOrderNumber(orderNumber)).thenReturn(Optional.of(order));
        
        assertThrows(BadRequestException.class, () -> 
            orderService.updateStatus(orderNumber, sellerId, OrderStatus.SHIPPED));
    }
    
    @Test
    void cancelOrder_NotOwnOrder_ThrowsBadRequest() {
        String orderNumber = "ORD-123";
        Order order = Order.builder().orderNumber(orderNumber).userId("userA").status(OrderStatus.PENDING).build();
        when(orderRepository.findByOrderNumber(orderNumber)).thenReturn(Optional.of(order));
        
        assertThrows(BadRequestException.class, () -> 
            orderService.cancelOrder(orderNumber, "userB"));
    }
    
    @Test
    void cancelOrder_AlreadyShipped_ThrowsIllegalState() {
        String orderNumber = "ORD-123";
        Order order = Order.builder().orderNumber(orderNumber).userId("user1").status(OrderStatus.SHIPPED).build();
        when(orderRepository.findByOrderNumber(orderNumber)).thenReturn(Optional.of(order));
        
        assertThrows(IllegalStateException.class, () -> 
            orderService.cancelOrder(orderNumber, "user1"));
    }
}
```

## File: `backend/order-service/src/test/java/com/buyone/orderservice/service/CartServiceTest.java`

```java
@ExtendWith(MockitoExtension.class)
class CartServiceTest {
    
    @Mock CartRepository cartRepository;
    @Mock ProductClient productClient;
    @InjectMocks CartServiceImpl cartService;
    
    @Test
    void addItem_InsufficientStock_ThrowsBadRequest() {
        String userId = "user123";
        CartItem item = CartItem.builder().productId("prod1").quantity(10).sellerId("seller1").build();
        Cart cart = Cart.builder().userId(userId).items(new ArrayList<>()).build();
        ProductResponse product = new ProductResponse();
        product.setQuantity(5);
        ApiResponse<ProductResponse> response = ApiResponse.<ProductResponse>builder().success(true).data(product).build();
        
        when(cartRepository.findById(userId)).thenReturn(Optional.of(cart));
        when(productClient.getById("prod1")).thenReturn(response);
        
        assertThrows(BadRequestException.class, () -> cartService.addItem(userId, item));
    }
    
    @Test
    void removeItem_NotInCart_LogsWarning() {
        String userId = "user123";
        Cart cart = Cart.builder().userId(userId).items(new ArrayList<>()).build();
        when(cartRepository.findById(userId)).thenReturn(Optional.of(cart));
        when(cartRepository.save(any())).thenAnswer(i -> i.getArgument(0));
        
        Cart result = cartService.removeItem(userId, "prod999");
        
        assertEquals(0, result.getItems().size());
    }
}
```

**Run**: `cd backend/order-service && mvn clean test jacoco:report`
```

***

### **PROMPT 4: Media Service**

```markdown
# Generate Unit Tests for Media Service

## File: `backend/media-service/src/test/java/com/buyone/mediaservice/service/MediaServiceTest.java`

```java
@ExtendWith(MockitoExtension.class)
class MediaServiceTest {
    
    @Mock MediaRepository mediaRepository;
    @Mock StorageService storageService;
    @InjectMocks MediaServiceImpl mediaService;
    
    @Test
    void uploadImage_FileTooLarge_ThrowsInvalidFile() {
        MockMultipartFile file = new MockMultipartFile("file", "test.jpg", "image/jpeg", new byte[3 * 1024 * 1024]); // 3MB
        
        assertThrows(InvalidFileException.class, () -> 
            mediaService.uploadImage(file, "user1", MediaOwnerType.USER, "user1", "CLIENT"));
    }
    
    @Test
    void uploadImage_NotImageType_ThrowsInvalidFile() {
        MockMultipartFile file = new MockMultipartFile("file", "test.pdf", "application/pdf", new byte);
        
        assertThrows(InvalidFileException.class, () -> 
            mediaService.uploadImage(file, "user1", MediaOwnerType.USER, "user1", "CLIENT"));
    }
    
    @Test
    void uploadImage_ProductExceedsMax_ThrowsConflict() {
        MockMultipartFile file = new MockMultipartFile("file", "test.jpg", "image/jpeg", new byte);
        when(mediaRepository.countByOwnerIdAndOwnerType("prod1", MediaOwnerType.PRODUCT)).thenReturn(5L);
        
        assertThrows(ConflictException.class, () -> 
            mediaService.uploadImage(file, "prod1", MediaOwnerType.PRODUCT, "seller1", "SELLER"));
    }
    
    @Test
    void deleteMedia_NotOwner_ThrowsForbidden() {
        String mediaId = "media123";
        Media media = Media.builder().id(mediaId).ownerId("seller1").ownerType(MediaOwnerType.PRODUCT).build();
        when(mediaRepository.findById(mediaId)).thenReturn(Optional.of(media));
        
        assertThrows(ForbiddenException.class, () -> 
            mediaService.deleteMedia(mediaId, "seller2", "SELLER"));
    }
    
    @Test
    void getMedia_NotFound_ThrowsMediaNotFound() {
        when(mediaRepository.findById("invalid")).thenReturn(Optional.empty());
        
        assertThrows(MediaNotFoundException.class, () -> 
            mediaService.getMedia("invalid"));
    }
}
```

**Run**: `cd backend/media-service && mvn clean test jacoco:report`
```

***

## üì¶ **ADD JACOCO TO ALL SERVICES**

**Add to each service's `pom.xml`**:
```xml
<build>
  <plugins>
    <plugin>
      <groupId>org.jacoco</groupId>
      <artifactId>jacoco-maven-plugin</artifactId>
      <version>0.8.11</version>
      <executions>
        <execution>
          <goals>
            <goal>prepare-agent</goal>
          </goals>
        </execution>
        <execution>
          <id>report</id>
          <phase>test</phase>
          <goals>
            <goal>report</goal>
          </goals>
        </execution>
        <execution>
          <id>jacoco-check</id>
          <goals>
            <goal>check</goal>
          </goals>
          <configuration>
            <rules>
              <rule>
                <element>PACKAGE</element>
                <limits>
                  <limit>
                    <counter>LINE</counter>
                    <value>COVEREDRATIO</value>
                    <minimum>0.80</minimum>
                  </limit>
                </limits>
              </rule>
            </rules>
          </configuration>
        </execution>
      </executions>
    </plugin>
  </plugins>
</build>
```

***

## ‚úÖ **EXECUTION PLAN**

### **Step 1: Generate Tests (Use Copilot Prompts Above)**
```bash
# For each service, paste the prompt into Copilot
# Generate ‚Üí Save ‚Üí Verify compilation
```

### **Step 2: Run Coverage**
```bash
# Run for each service
cd backend/product-service && mvn clean test jacoco:report
cd backend/user-service && mvn clean test jacoco:report
cd backend/order-service && mvn clean test jacoco:report
cd backend/media-service && mvn clean test jacoco:report
```

### **Step 3: View Reports**
```
Open in browser:
- backend/product-service/target/site/jacoco/index.html
- backend/user-service/target/site/jacoco/index.html
- backend/order-service/target/site/jacoco/index.html
- backend/media-service/target/site/jacoco/index.html
```

### **Step 4: Verify 80%+ Coverage**
```
Target per service:
‚úÖ product-service: 85%+
‚úÖ user-service: 80%+
‚úÖ order-service: 80%+
‚úÖ media-service: 75%+
```

***

## üéØ **SUMMARY**

**Your project has ZERO tests currently** - this is the #1 priority to fix for:
1. SonarQube quality gate
2. Jenkins pipeline success
3. Production readiness

